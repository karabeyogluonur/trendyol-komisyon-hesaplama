@model ProductListViewModel

<div class="card mb-5">
    <div class="card-body py-4">
        <div id="kt_app_toolbar" class="app-toolbar">
            <div class="d-flex flex-stack w-100 flex-wrap gap-4">

                <div class="page-title d-flex flex-column justify-content-center gap-2">
                    <h1 class="page-heading fw-bold fs-4 text-gray-900 mb-0">
                        Ürün Yönetimi
                    </h1>
                    <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 text-gray-600 mb-0">
                        <li class="breadcrumb-item">
                            <a href="/" class="text-gray-600 text-hover-primary">Anasayfa</a>
                        </li>
                        <li class="breadcrumb-item">
                            <span class="bullet bg-gray-400 w-5px h-2px"></span>
                        </li>
                        <li class="breadcrumb-item">
                            <span class="text-gray-600">Ürün Yönetimi</span>
                        </li>
                    </ul>
                </div>

                <div class="d-flex align-items-center gap-3">
                    <form method="get" class="d-flex align-items-center gap-2 position-relative">
                        <input type="hidden" name="PageIndex" value="1" />

                        <div class="d-flex align-items-center position-relative my-1">
                            <i class="ki-outline ki-magnifier fs-3 position-absolute ms-3"></i>
                            <input type="text" name="Barcode" value="@Model.Filter.Barcode"
                                class="form-control form-control-sm form-control-solid w-200px ps-10"
                                placeholder="Barkod Ara..." />
                        </div>

                        <button type="button" class="btn btn-sm btn-light-primary" data-kt-menu-trigger="click"
                            data-kt-menu-placement="bottom-end">
                            <i class="ki-outline ki-filter fs-2"></i>
                            Filtrele
                        </button>

                        <div class="menu menu-sub menu-sub-dropdown w-300px w-md-325px" data-kt-menu="true">
                            <div class="px-7 py-5">
                                <div class="fs-5 text-gray-900 fw-bold">Filtre Seçenekleri</div>
                            </div>
                            <div class="separator border-gray-200"></div>

                            <div class="px-7 py-5">
                                <div class="mb-5">
                                    <label class="form-label fw-semibold">Kategori</label>
                                    <select name="CategoryId" class="form-select form-select-solid form-select-sm">
                                        <!option value="" @(!Model.Filter.CategoryId.HasValue ? "selected" : "")>Tümü
                                        </!option>
                                        @foreach (var item in Model.Filter.Categories ??
                                                                                Enumerable.Empty<SelectListItem>())
                                        {
                                            <!option value="@item.Value" @(item.Selected ? "selected" : "")>@item.Text
                                            </!option>
                                        }
                                    </select>
                                </div>

                                <div class="mb-5">
                                    <label class="form-label fw-semibold">Stok Durumu</label>
                                    <select name="HasStock" class="form-select form-select-solid form-select-sm">
                                        <!option value="" @(!Model.Filter.HasStock.HasValue ? "selected" : "")>Tümü
                                        </!option>
                                        <!option value="true" @(Model.Filter.HasStock == true ? "selected" : "")>Stokta
                                            Var</!option>
                                        <!option value="false" @(Model.Filter.HasStock == false ? "selected" : "")>Stok
                                            Yok</!option>
                                    </select>
                                </div>

                                <div class="mb-5">
                                    <label class="form-label fw-semibold">Satış Durumu</label>
                                    <select name="IsOnSale" class="form-select form-select-solid form-select-sm">
                                        <!option value="" @(!Model.Filter.IsOnSale.HasValue ? "selected" : "")>Tümü
                                        </!option>
                                        <!option value="true" @(Model.Filter.IsOnSale == true ? "selected" : "")>Satışta
                                        </!option>
                                        <!option value="false" @(Model.Filter.IsOnSale == false ? "selected" : "")>
                                            Satışa Kapalı</!option>
                                    </select>
                                </div>

                                <div class="d-flex justify-content-end">
                                    <a href="@Url.Action("Index")"
                                        class="btn btn-sm btn-light btn-active-light-primary me-2">
                                        Temizle
                                    </a>
                                    <button type="submit" class="btn btn-sm btn-primary">
                                        Uygula
                                    </button>
                                </div>
                            </div>
                        </div>

                        <select name="PageSize" onchange="this.form.submit()"
                            class="form-select form-select-sm form-select-solid w-80px">
                            @foreach (int size in new[] { 10, 20, 50, 100 })
                            {
                                <!option value="@size" @(Model.Filter.PageSize == size ? "selected" : "")>@size</!option>
                            }
                        </select>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card card-flush">
    <div class="card-body pt-0">
        <div class="table-responsive">
            <table class="table align-middle table-row-dashed fs-6 gy-5">
                <thead>
                    <tr class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0">
                        <th class="min-w-250px">Ürün</th>
                        <th class="min-w-200px">Kategori</th>
                        <th class="min-w-120px">Barkod / SKU</th>
                        <th class="min-w-100px">Fiyat</th>
                        <th class="min-w-100px">Stok</th>
                        <th class="text-end min-w-125px">Durum</th>
                    </tr>
                </thead>
                <tbody class="fw-semibold text-gray-600">
                    @if (Model.Products != null && Model.Products.Items.Any())
                    {
                        foreach (var product in Model.Products.Items)
                        {
                            var shortName = product.Name?.Length > 50
                            ? product.Name.Substring(0, 50) + "…"
                            : product.Name;

                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <a href="@product.ExternalUrl" target="_blank" class="symbol symbol-60px me-4">
                                            @if (!string.IsNullOrEmpty(product.ImageUrl))
                                            {
                                                <span class="symbol-label" style="background-image:url(@product.ImageUrl);"></span>
                                            }
                                            else
                                            {
                                                <span class="symbol-label bg-light-primary text-primary fw-bold fs-2">
                                                    @product.Name.Substring(0, 1)
                                                </span>
                                            }
                                        </a>

                                        <div class="d-flex flex-column">
                                            <span class="text-gray-800 fw-bold fs-7" title="@product.Name">
                                                @shortName
                                            </span>
                                            <span class="text-muted fs-8">@product.VariantSummary</span>
                                        </div>
                                    </div>
                                </td>

                                <td>
                                    <span class="fs-7">@product.CategoryName</span>
                                </td>

                                <td>
                                    <div class="d-flex flex-column">
                                        <span class="text-dark fw-bold">@product.Barcode</span>
                                        <span class="text-muted fs-9">@product.Sku</span>
                                    </div>
                                </td>

                                <td>
                                    <span class="text-gray-800 fw-bold fs-6">
                                        @product.SellingPrice.ToString("N2") ₺
                                    </span>
                                    @if (product.ListPrice > product.SellingPrice)
                                    {
                                        <span class="text-gray-400 text-decoration-line-through fs-9 d-block">
                                            @product.ListPrice.ToString("N2")
                                        </span>
                                    }
                                </td>

                                <td>
                                    <span class="badge badge-light-@product.StockStatusClass px-3 py-2 fs-7">
                                        @product.StockQuantity
                                    </span>
                                    @if (product.IsLocked)
                                    {
                                        <i class="ki-outline ki-lock fs-5 text-warning ms-1" title="Kilitli"></i>
                                    }
                                </td>

                                <td class="text-end">
                                    <div class="d-flex flex-column gap-2 align-items-end">
                                        <span
                                            class="badge badge-light-@(product.IsApproved ? "success" : "warning") w-100px py-3 justify-content-center">
                                            @(product.IsApproved ? "Onaylı" : "Onay Bekliyor")
                                        </span>
                                        <span
                                            class="badge badge-light-@(product.IsOnSale ? "primary" : "danger") w-100px py-3 justify-content-center">
                                            @(product.IsOnSale ? "Satışta" : "Satışa Kapalı")
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center py-10">
                                <div class="d-flex flex-column align-items-center">
                                    <i class="ki-outline ki-magnifier fs-3x text-gray-300 mb-4"></i>
                                    <span class="text-gray-500 fw-semibold fs-5">
                                        Aradığınız kriterlere uygun kayıt bulunamadı.
                                    </span>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (Model.Products != null && Model.Products.TotalPages > 1)
        {
            <div class="row pt-10">
                <div class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start">
                    <div class="dataTables_info text-gray-600 fs-7">
                        Toplam <strong>@Model.Products.TotalCount</strong> kayıttan
                        <strong>@((Model.Products.PageIndex - 1) * Model.Products.PageSize + 1)</strong> -
                        <strong>@(Math.Min(Model.Products.PageIndex * Model.Products.PageSize,
                                                    Model.Products.TotalCount))</strong>
                        arası gösteriliyor.
                    </div>
                </div>

                <div class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
                    <ul class="pagination">
                        <li class="page-item previous @(Model.Products.HasPreviousPage ? "" : "disabled")">
                            <a class="page-link"
                                href="@Url.Action("Index", new { PageIndex = Model.Products.PageIndex - 1, PageSize = Model.Products.PageSize, Barcode = Model.Filter.Barcode, CategoryId = Model.Filter.CategoryId, HasStock = Model.Filter.HasStock, IsOnSale = Model.Filter.IsOnSale })">
                                <i class="previous"></i>
                            </a>
                        </li>

                        @for (int i = 1; i <= Model.Products.TotalPages; i++)
                        {
                            if (i == 1 || i == Model.Products.TotalPages || (i >= Model.Products.PageIndex - 2 && i <=
                            Model.Products.PageIndex + 2))
                            {
                                <li class="page-item @(i == Model.Products.PageIndex ? "active" : "")">
                                    <a class="page-link"
                                        href="@Url.Action("Index", new { PageIndex = i, PageSize = Model.Products.PageSize, Barcode = Model.Filter.Barcode, CategoryId = Model.Filter.CategoryId, HasStock = Model.Filter.HasStock, IsOnSale = Model.Filter.IsOnSale })">
                                        @i
                                    </a>
                                </li>
                            }
                            else if (i == Model.Products.PageIndex - 3 || i == Model.Products.PageIndex + 3)
                            {
                                <li class="page-item disabled"><span class="page-link">...</span></li>
                            }
                        }

                        <li class="page-item next @(Model.Products.HasNextPage ? "" : "disabled")">
                            <a class="page-link"
                                href="@Url.Action("Index", new { PageIndex = Model.Products.PageIndex + 1, PageSize = Model.Products.PageSize, Barcode = Model.Filter.Barcode, CategoryId = Model.Filter.CategoryId, HasStock = Model.Filter.HasStock, IsOnSale = Model.Filter.IsOnSale })">
                                <i class="next"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        }
    </div>
</div>
